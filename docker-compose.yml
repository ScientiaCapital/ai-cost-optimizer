# AI Cost Optimizer - Docker Compose
# Simplified configuration for Supabase-based deployment
# No local database services needed - using Supabase managed infrastructure

services:
  api:
    build: .
    container_name: optimizer-api
    environment:
      # Supabase Configuration
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_ANON_KEY: ${SUPABASE_ANON_KEY}
      SUPABASE_SERVICE_KEY: ${SUPABASE_SERVICE_KEY}
      SUPABASE_JWT_SECRET: ${SUPABASE_JWT_SECRET}

      # AI Provider API Keys
      GOOGLE_API_KEY: ${GOOGLE_API_KEY}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY}
      CEREBRAS_API_KEY: ${CEREBRAS_API_KEY}

      # Embedding Configuration
      EMBEDDING_MODEL_NAME: ${EMBEDDING_MODEL_NAME:-sentence-transformers/all-MiniLM-L6-v2}
      EMBEDDING_DEVICE: ${EMBEDDING_DEVICE:-cpu}
      SIMILARITY_THRESHOLD: ${SIMILARITY_THRESHOLD:-0.95}

      # Application Configuration
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      COST_OPTIMIZER_API_URL: ${COST_OPTIMIZER_API_URL:-http://localhost:8000}
    ports:
      - "8000:8000"
    restart: unless-stopped
    networks:
      - optimizer-network
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000
    # Health check for the API
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  optimizer-network:
    driver: bridge

# Note: All data storage is managed by Supabase
# - PostgreSQL database (with pgvector)
# - Real-time subscriptions
# - Row-level security (RLS)
# - Authentication (JWT)
#
# Access your Supabase dashboard at:
# https://supabase.com/dashboard/project/YOUR_PROJECT_ID
